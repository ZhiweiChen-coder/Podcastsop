## 播客文案编辑器（Streamlit）

面向 **播客、公众号深度访谈、社媒素材** 的一体化文案工作台。  
把你的逐字稿上传进去，按模块 A/B/C/D/E 分步加工、可视化对比、版本管理，最后一键导出成稿。

---

### 功能概览

- **多用途发稿流程**
  - 公众号深度访谈：A 重清洗 → B 逻辑重排 → C 媒体成稿
  - 播客口播：A 重清洗 → B 逻辑重排 → E 播客朗读
  - 社媒素材：A 重清洗 → B 逻辑重排 → C 媒体成稿 → D 传播增强
- **大型编辑器**：核心工作区是一个大号文本编辑器，支持直接改写模型输出
- **差异对比**：查看「上一模块输入 vs 当前模块输出」的差异（按行 / 按词）
- **版本管理**：每个模块都可以「保存为版本」、回滚到历史版本
- **多格式导出**：支持导出为 `markdown` / `txt` / `docx`

---

### 本地运行

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
streamlit run app.py
```

浏览器中打开终端提示的地址（一般是 `http://localhost:8501`）。

---

### 配置 DeepSeek 模型

1. 将仓库中的 `.env.example` 复制为 `.env`
2. 在 `.env` 中填写你的 `DEEPSEEK_API_KEY`
3. DeepSeek 控制台地址：<https://platform.deepseek.com/>
4. 应用启动时会通过 `python-dotenv` 自动加载环境变量

> 提示：部署到 Streamlit Cloud 时，不需要上传 `.env`，建议把 `DEEPSEEK_API_KEY` 配置在 **Secrets** 里。

---

### 使用步骤（如何用）

1. **选择发稿用途**
   - 顶部右侧下拉框选择：`公众号深度访谈` / `播客口播` / `社媒素材`
   - 不同用途会只展示对应需要的模块（最多 3–4 个步骤）

2. **上传逐字稿**
   - 左侧「输入区」点击 **Browse files** 或拖拽文件
   - 支持：`docx` / `txt` / `srt`，单文件 ≤ 200MB
   - 读取成功后，逐字稿会写入 `项目状态` 中的 `input_raw`

3. **设置基础信息**
   - 顶部填写 `项目标题`（例如：第 12 期｜AI 创业访谈）
   - 侧边栏：
     - `语言选择`：中文 / 英文 / 双语
     - `说话人标签规则`：如「主持人 / 嘉宾」
     - `模型设置区`：选择模型提供方（当前主要用 DeepSeek）、温度、最大 tokens、是否严格不增内容

4. **按模块逐步生成**
   - 进入模块 A/B/C/D/E 中的任意一个 Tab（按流程从左到右）
   - 点击 **「▶ 运行本模块」**：
     - 模块输入：自动取上一模块的输出（例如 B 的输入是 A 的输出）
     - 模型输出：会写入下面的大号「主编辑区」
   - 如对结果不满意，可点击 **「🔄 重新生成」**（会先把当前版本存入历史）

5. **编辑与版本管理**
   - 在「主编辑区」直接手动微调、改写
   - 满意后点击 **「💾 保存为版本」**：
     - 当前内容会记录为 `A-1`、`B-2` 这类版本号
   - 下方「历史版本」中可以查看所有版本，并一键回滚
   - 「差异对比」支持用高亮方式查看：原始输入 vs 当前输出 的改动

6. **导出成稿**
   - 页面底部「📤 导出」区域：
     - 选择发稿用途（决定导出用哪一个模块：公众号 → C，播客 → E，社媒 → D）
     - 选择导出格式：`markdown` / `txt` / `docx`
     - 选择版本：`current` 或某个历史版本号
   - 点击下载按钮，即可得到对应格式的文稿文件

---

### 部署到 Streamlit Cloud（可选）

1. 把代码推到 GitHub 仓库（确保包含 `app.py`、`core/`、`requirements.txt`、`README.md`）
2. 访问 <https://share.streamlit.io>，登录并创建新应用
   - Repo：你的 GitHub 仓库
   - Branch：`main`
   - Main file：`app.py`
3. 在应用的 **Settings → Secrets** 中配置：

```toml
DEEPSEEK_API_KEY = "sk-xxxxxxxx"
```

保存后，Streamlit 会自动重启应用，和本地体验一致。

